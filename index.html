<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>202602åŒ—ä¹å·ä¹‹æ—…</title>
    <!-- å¼•å…¥ Noto Sans TC å­—é«” -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. æ ¸å¿ƒè®Šæ•¸èˆ‡é‡ç½® (ä¿®æ”¹é…è‰²ç‚ºæº«é¦¨ç±³è‰²èª¿) --- */
        :root {
            --bg-color: #FAF7F2; /* æº«é¦¨ç±³è‰²èƒŒæ™¯ */
            --card-bg: #FFFFFF;
            --text-primary: #5A4A42; /* æ·±è¤è‰² */
            --text-secondary: #9C8C84; /* æ·ºè¤è‰² */
            --accent-color: #D99A6C; /* æº«æš–çš„æ©˜è¤è‰² */
            --accent-gradient: linear-gradient(135deg, #D99A6C 0%, #B87A50 100%);
            --danger-color: #E74C3C;
            --radius-l: 24px;
            --radius-m: 16px;
            --radius-s: 12px;
            --shadow-soft: 0 8px 30px rgba(90, 74, 66, 0.06); /* èª¿æ•´é™°å½±é¡è‰² */
            --shadow-card: 0 4px 12px rgba(90, 74, 66, 0.04);
            --blur-bg: rgba(250, 247, 242, 0.85); /* èª¿æ•´æ¯›ç»ç’ƒèƒŒæ™¯è‰² */
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-primary);
            /* é ç•™åº•éƒ¨å°èˆªæ¬„ç©ºé–“ */
            padding-bottom: calc(100px + var(--safe-bottom)); 
        }

        /* --- 2. å„€å¼æ„Ÿé¦–é  (Hero Section - ä¿®æ”¹åœ–ç‰‡) --- */
        .hero-header {
            position: relative;
            height: 380px;
            /* æ›´æ›ç‚ºä¹å·è‡ªç„¶é¢¨æ™¯åœ–ç‰‡ (ä¾‹å¦‚é˜¿è˜‡å±±) */
            background-image: url('https://images.unsplash.com/photo-1627902314049-812a02602d22?q=80&w=1600&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 10px 40px rgba(90,74,66,0.15); /* èª¿æ•´é™°å½±é¡è‰² */
            overflow: hidden;
            margin-bottom: -40px; /* è®“å¡ç‰‡å¾€ä¸Šç–Š */
            z-index: 0;
        }

        .hero-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            /* èª¿æ•´é®ç½©é¡è‰²ç‚ºæš–è‰²èª¿ */
            background: linear-gradient(to bottom, rgba(90,74,66,0.1), rgba(90,74,66,0.5));
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 40px 30px 60px 30px;
        }

        .hero-title {
            color: white;
            font-size: 36px;
            font-weight: 700;
            margin: 0;
            letter-spacing: 0.05em;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            line-height: 1.2;
        }
        
        .hero-subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 15px;
            margin-top: 8px;
            font-weight: 400;
            letter-spacing: 0.1em;
        }

        /* --- 3. é€šç”¨å®¹å™¨èˆ‡å¡ç‰‡ --- */
        .container {
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }

        .section-view {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .section-view.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius-l);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(255,255,255,0.5);
        }

        h2 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 30px 0 15px 5px;
        }

        /* --- 4. è¡Œç¨‹ç¸½è¦½ (Overview) --- */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-box {
            background: #FDFBF8; /* èª¿æ•´èƒŒæ™¯è‰² */
            padding: 15px;
            border-radius: var(--radius-m);
            text-align: center;
        }
        
        /* å¢åŠ å¯é»æ“Šæ¨£å¼ */
        .info-box.clickable {
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            position: relative;
        }
        .info-box.clickable:active {
            transform: scale(0.96);
            background-color: #F5EFE6;
        }
        .info-icon {
            font-size: 12px;
            color: var(--accent-color);
            margin-left: 4px;
        }

        .info-label { font-size: 12px; color: var(--text-secondary); margin-bottom: 5px; }
        .info-value { font-size: 16px; font-weight: 600; color: var(--text-primary); }

        .hotel-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .hotel-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #EFEFEF;
        }
        .hotel-item:last-child { border-bottom: none; padding-bottom: 0; }
        .hotel-date-badge {
            background: var(--accent-color); /* ä½¿ç”¨å¼·èª¿è‰² */
            color: white;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 700;
            min-width: 50px;
            text-align: center;
        }
        .hotel-details h3 { margin: 0; font-size: 15px; font-weight: 600; }
        .hotel-details p { margin: 4px 0 0; font-size: 13px; color: var(--text-secondary); }

        /* --- Modal å½ˆå‡ºè¦–çª—æ¨£å¼ --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(90, 74, 66, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background: #FFFFFF;
            width: 85%;
            max-width: 400px;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-header h3 { margin: 0; font-size: 20px; color: var(--text-primary); font-weight: 700; }
        .close-modal-btn {
            background: #F2F2F7;
            border: none;
            width: 32px; height: 32px;
            border-radius: 50%;
            font-size: 18px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        
        /* èˆªç­è³‡è¨Šå¡ç‰‡ */
        .flight-leg {
            background: #FDFBF8;
            border: 1px solid #EFEFEF;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            position: relative;
            overflow: hidden;
        }
        .flight-leg::before {
            content: '';
            position: absolute;
            left: 0; top: 0; bottom: 0;
            width: 4px;
            background: var(--text-secondary);
        }
        .flight-leg.outbound::before { background: #D99A6C; /* å»ç¨‹æ©˜è‰² */ }
        .flight-leg.inbound::before { background: #86A873; /* å›ç¨‹ç¶ è‰² (æ­é…ç±³è‰²èª¿çš„ç¶ ) */ }

        .leg-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 13px;
        }
        .tag {
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 4px;
            color: white;
            font-size: 11px;
        }
        .tag.outbound { background: #D99A6C; }
        .tag.inbound { background: #86A873; }
        .date { color: var(--text-secondary); font-weight: 500; }

        .flight-route {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .point { text-align: center; }
        .point .time { font-size: 24px; font-weight: 700; color: var(--text-primary); line-height: 1; margin-bottom: 4px; }
        .point .code { font-size: 13px; color: var(--text-secondary); font-weight: 500; }
        .arrow { font-size: 20px; color: #E5E5EA; }
        
        .flight-detail {
            border-top: 1px dashed #E5E5EA;
            padding-top: 10px;
            font-size: 13px;
            color: var(--text-primary);
            line-height: 1.6;
        }
        .pnr {
            display: inline-block;
            background: #F0EAE4;
            color: #5A4A42;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
            margin-top: 4px;
            letter-spacing: 0.5px;
        }


        /* --- 5. æ¯æ—¥è¡Œç¨‹ (Timeline) --- */
        /* æ—¥æœŸé¸æ“‡å™¨ - è† å›Šç‹€ */
        .date-scroller-wrapper {
            position: sticky;
            top: 0;
            background: var(--blur-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 10;
            padding: 10px 0 15px 0;
            margin-left: -20px;
            margin-right: -20px;
            box-shadow: 0 1px 0 rgba(90,74,66,0.05); /* èª¿æ•´é™°å½± */
        }

        .date-scroller {
            display: flex;
            overflow-x: auto;
            padding: 5px 20px;
            gap: 10px;
            scrollbar-width: none;
        }
        .date-scroller::-webkit-scrollbar { display: none; }

        .date-chip {
            background: white;
            padding: 10px 18px;
            border-radius: 24px;
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(90,74,66,0.03); /* èª¿æ•´é™°å½± */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid transparent;
        }
        .date-chip.active {
            background: var(--accent-color); /* ä½¿ç”¨å¼·èª¿è‰² */
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(217, 154, 108, 0.3); /* èª¿æ•´é™°å½±é¡è‰² */
        }
        
        /* é«”åŠ›æ¶ˆè€—é¡¯ç¤º */
        .stamina-level {
            font-size: 14px;
            color: var(--accent-color);
            margin-top: 5px;
            font-weight: 500;
        }

        /* æ™‚é–“è»¸æ¨£å¼ */
        .timeline-container {
            padding-top: 20px;
        }
        .timeline-item {
            position: relative;
            padding-left: 30px; /* ç·šæ¢ç©ºé–“ */
            padding-bottom: 40px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 7px;
            top: 5px;
            bottom: -5px;
            width: 2px;
            background: #E5E5EA;
            border-radius: 2px;
        }
        .timeline-item:last-child::before { display: none; }
        
        .timeline-dot {
            position: absolute;
            left: 0;
            top: 5px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            border: 4px solid var(--accent-color);
            box-shadow: 0 0 0 4px rgba(217, 154, 108, 0.1); /* èª¿æ•´é™°å½±é¡è‰² */
        }
        
        .time-badge {
            display: inline-block;
            font-size: 13px;
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: 6px;
            background: rgba(217, 154, 108, 0.1); /* èª¿æ•´èƒŒæ™¯è‰² */
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        .event-card {
            background: white;
            border-radius: var(--radius-m);
            padding: 16px;
            box-shadow: var(--shadow-card);
        }
        
        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .event-title {
            font-size: 16px;
            font-weight: 700;
            margin: 0 0 6px 0;
            line-height: 1.4;
        }
        
        .event-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin: 0;
        }
        
        .map-btn {
            background: #F2F2F7;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
            flex-shrink: 0;
            margin-left: 10px;
        }
        .map-btn:active { background: #E5E5EA; }
        .map-btn svg { width: 20px; height: 20px; fill: var(--accent-color); }
        
        .note-alert {
            margin-top: 10px;
            font-size: 13px;
            color: #D95C09;
            background: #FFF5E0;
            padding: 8px 12px;
            border-radius: 8px;
            display: flex;
            gap: 6px;
        }

        /* --- 6. è³¼ç‰©æ¸…å–® (Shopping) --- */
        .add-row {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: white;
            padding: 10px;
            border-radius: var(--radius-l);
            box-shadow: var(--shadow-card);
        }
        .ios-input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 16px;
            padding: 8px;
            outline: none;
            color: var(--text-primary); /* èª¿æ•´æ–‡å­—é¡è‰² */
        }
        .add-btn {
            background: var(--accent-color); /* ä½¿ç”¨å¼·èª¿è‰² */
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .shop-item {
            background: white;
            border-radius: var(--radius-m);
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(90,74,66,0.02); /* èª¿æ•´é™°å½± */
            transition: all 0.3s;
        }
        
        .shop-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .checkbox {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid #C7C7CC;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .shop-item.done .checkbox {
            background: var(--accent-color);
            border-color: var(--accent-color);
        }
        .shop-item.done .item-name {
            text-decoration: line-through;
            color: #C7C7CC;
        }
        
        .item-info h4 { margin: 0; font-size: 16px; font-weight: 500; }
        .item-meta { font-size: 13px; color: var(--text-secondary); margin-top: 2px; }
        
        .delete-btn {
            color: var(--danger-color);
            background: none;
            border: none;
            padding: 8px 12px; /* å¢åŠ é»æ“Šç¯„åœ */
            font-size: 16px;
            cursor: pointer;
        }

        /* --- åŒ¯ç‡è¨ˆç®—æ©Ÿæ¨£å¼ --- */
        .rate-card {
            background: white;
            border-radius: var(--radius-l);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-card);
        }
        .rate-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .rate-text { font-size: 15px; color: var(--text-secondary); font-weight: 500; }
        .rate-value { font-size: 18px; color: var(--accent-color); font-weight: 700; }
        .edit-rate-btn {
            background: #F2F2F7; border: none;
            width: 32px; height: 32px; border-radius: 50%;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        
        .calc-display {
            background: #F9F9FB;
            border-radius: var(--radius-m);
            padding: 15px;
            margin-bottom: 15px;
            text-align: right;
            height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .calc-mode { font-size: 13px; color: var(--text-secondary); margin-bottom: 4px; }
        .calc-input { font-size: 20px; color: var(--text-primary); margin-bottom: 4px; }
        .calc-result { font-size: 28px; color: var(--accent-color); font-weight: 700; line-height: 1.2; }
        
        .calc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        .calc-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 50%;
            font-size: 22px;
            font-weight: 500;
            background: #E5E5EA;
            color: var(--text-primary);
            cursor: pointer;
            transition: opacity 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .calc-btn:active { opacity: 0.7; }
        .calc-btn.op { background: var(--accent-color); color: white; font-size: 20px; }
        .calc-btn.zero { grid-column: span 2; aspect-ratio: auto; border-radius: 40px; }
        .calc-btn.clear { background: #D4D4D2; color: #333; font-size: 18px; }
        
        .toggle-currency-btn {
            width: 100%;
            background: #F2F2F7;
            color: var(--text-primary);
            border: none;
            padding: 12px;
            border-radius: var(--radius-m);
            font-weight: 600;
            margin-bottom: 15px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            cursor: pointer;
        }
        .external-link {
            display: block;
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 15px;
            text-decoration: none;
        }

        /* --- 7. æ‡¸æµ®å°èˆª (Floating Dock) --- */
        .dock-container {
            position: fixed;
            bottom: calc(20px + var(--safe-bottom));
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            width: auto;
        }
        
        .dock {
            display: flex;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            padding: 6px;
            border-radius: 32px;
            box-shadow: 0 15px 40px rgba(90,74,66,0.12); /* èª¿æ•´é™°å½± */
            border: 1px solid rgba(255,255,255,0.4);
        }
        
        .dock-item {
            padding: 10px 18px; /* ç¨å¾®ç¸®å°é–“è·ä»¥å®¹ç´4å€‹ */
            border-radius: 24px;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 70px;
        }
        
        .dock-item svg {
            width: 24px;
            height: 24px;
            fill: var(--text-secondary);
            transition: all 0.3s;
        }
        
        .dock-item.active {
            background: white;
            color: var(--accent-color); /* ä½¿ç”¨å¼·èª¿è‰² */
            box-shadow: 0 4px 12px rgba(90,74,66,0.08); /* èª¿æ•´é™°å½± */
        }
        
        .dock-item.active svg {
            fill: var(--accent-color); /* ä½¿ç”¨å¼·èª¿è‰² */
        }

        /* è¼”åŠ©é¡ */
        .empty-state {
            text-align: center;
            color: var(--text-secondary);
            margin-top: 40px;
            font-size: 14px;
        }

    </style>
</head>
<body>

    <!-- é é¢ 1: è¡Œç¨‹ç¸½è¦½ -->
    <div id="view-overview" class="section-view active">
        <header class="hero-header">
            <div class="hero-overlay">
                <h1 class="hero-title">2026<br>åŒ—ä¹å·ä¹‹æ—…</h1>
                <div class="hero-subtitle">Feb 21 - Feb 27 Â· 7 Days</div>
            </div>
        </header>

        <div class="container" style="margin-top: -30px;">
            <div class="card">
                <div class="info-grid">
                    <div class="info-box clickable" onclick="showFlightModal()">
                        <div class="info-label">é€²å‡ºæ©Ÿå ´ <span class="info-icon">â“˜</span></div>
                        <div class="info-value">ç†Šæœ¬ KMJ - ç¦å²¡ FUK</div>
                    </div>
                    <div class="info-box">
                        <div class="info-label">æ—…å®¢</div>
                        <div class="info-value">è²“å’ªäºŒäººçµ„</div>
                    </div>
                </div>

                <h2 style="margin-top:0; margin-bottom:15px; font-size:15px; color:#9C8C84; text-transform:uppercase;">ä½å®¿å®‰æ’</h2>
                <div class="hotel-list">
                    <div class="hotel-item">
                        <div class="hotel-date-badge">2/21<br> -22</div>
                        <div class="hotel-details">
                            <h3>ç†Šæœ¬ REF é£¯åº—</h3>
                            <p>ç†Šæœ¬å¸‚ä¸­å¿ƒ | å¤§æµ´å ´èˆ‡è±å¯Œæ—©é¤</p>
                        </div>
                    </div>
                    <div class="hotel-item">
                        <div class="hotel-date-badge">2/23</div>
                        <div class="hotel-details">
                            <h3>å¤§åˆ† JR Blossom</h3>
                            <p>å¤§åˆ†è»Šç«™ç›´é”</p>
                        </div>
                    </div>
                    <div class="hotel-item">
                        <div class="hotel-date-badge">2/24<br> -26</div>
                        <div class="hotel-details">
                            <h3>ç¦å²¡ The OneFive Villa</h3>
                            <p>ä¸­æ´²å·ç«¯ | äº¤é€šä¾¿åˆ©</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="height: 20px;"></div>
        </div>
    </div>

    <!-- é é¢ 2: æ¯æ—¥è¡Œç¨‹ -->
    <div id="view-daily" class="section-view">
        <div style="padding: 60px 20px 0 20px;">
            <h1 style="font-size:28px; font-weight:700; margin-bottom:5px;">æ¯æ—¥è¡Œç¨‹</h1>
            <p style="color:var(--text-secondary); margin-top:0;">æ¢ç´¢åŒ—ä¹å·çš„å¤šé‡æ¨£è²Œ</p>
        </div>

        <div class="container">
            <!-- é»æ€§æ—¥æœŸé¸å–® -->
            <div class="date-scroller-wrapper">
                <div class="date-scroller" id="day-nav">
                    <!-- JS ç”Ÿæˆ -->
                </div>
            </div>

            <!-- å‹•æ…‹å…§å®¹å€ -->
            <div id="daily-timeline" class="timeline-container">
                <!-- JS æ¸²æŸ“ -->
            </div>
        </div>
    </div>

    <!-- é é¢ 3: è³¼ç‰©æ¸…å–® -->
    <div id="view-shopping" class="section-view">
        <div style="padding: 60px 20px 20px 20px;">
            <h1 style="font-size:28px; font-weight:700; margin-bottom:5px;">è³¼ç‰©æ¸…å–®</h1>
            <p style="color:var(--text-secondary); margin-top:0;">åˆ¥å¿˜äº†è²·å›å®¶çš„æ±è¥¿</p>
        </div>

        <div class="container">
            <div class="add-row">
                <input type="text" id="shop-name" class="ios-input" placeholder="æ–°å¢è³¼è²·é …ç›®...">
                <button class="add-btn" onclick="addItem()">ï¼‹</button>
            </div>
            
            <div id="shopping-list">
                <!-- JS æ¸²æŸ“ -->
            </div>
        </div>
    </div>

    <!-- é é¢ 4: åŒ¯ç‡è¨ˆç®—æ©Ÿ (æ–°å¢) -->
    <div id="view-currency" class="section-view">
        <div style="padding: 60px 20px 20px 20px;">
            <h1 style="font-size:28px; font-weight:700; margin-bottom:5px;">åŒ¯ç‡è¨ˆç®—æ©Ÿ</h1>
            <p style="color:var(--text-secondary); margin-top:0;">å¿«é€Ÿæ›ç®—æ—¥å¹£èˆ‡å°å¹£</p>
        </div>

        <div class="container">
            <div class="rate-card">
                <div class="rate-info">
                    <div>
                        <div class="rate-text">ç›®å‰åŒ¯ç‡ (JPY to TWD)</div>
                        <div class="rate-value" id="current-rate-display">0.2000</div>
                    </div>
                    <button class="edit-rate-btn" onclick="openRateModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9C8C84" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                    </button>
                </div>

                <button class="toggle-currency-btn" onclick="toggleCurrencyMode()">
                    <span id="currency-mode-text">æ—¥å¹£ JPY â†’ å°å¹£ TWD</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/></svg>
                </button>

                <div class="calc-display">
                    <div class="calc-mode" id="calc-mode-hint">è¼¸å…¥ JPY</div>
                    <div class="calc-input" id="calc-input">0</div>
                    <div class="calc-result" id="calc-result">â‰ˆ NT$0</div>
                </div>

                <div class="calc-grid">
                    <button class="calc-btn clear" onclick="calcInput('C')">C</button>
                    <button class="calc-btn clear" onclick="calcInput('DEL')">âŒ«</button>
                    <button class="calc-btn clear" onclick="calcInput('/')">Ã·</button>
                    <button class="calc-btn op" onclick="calcInput('*')">Ã—</button>
                    
                    <button class="calc-btn" onclick="calcInput('7')">7</button>
                    <button class="calc-btn" onclick="calcInput('8')">8</button>
                    <button class="calc-btn" onclick="calcInput('9')">9</button>
                    <button class="calc-btn op" onclick="calcInput('-')">-</button>
                    
                    <button class="calc-btn" onclick="calcInput('4')">4</button>
                    <button class="calc-btn" onclick="calcInput('5')">5</button>
                    <button class="calc-btn" onclick="calcInput('6')">6</button>
                    <button class="calc-btn op" onclick="calcInput('+')">+</button>
                    
                    <button class="calc-btn" onclick="calcInput('1')">1</button>
                    <button class="calc-btn" onclick="calcInput('2')">2</button>
                    <button class="calc-btn" onclick="calcInput('3')">3</button>
                    <button class="calc-btn op" onclick="calcInput('=')">=</button>
                    
                    <button class="calc-btn zero" onclick="calcInput('0')">0</button>
                    <button class="calc-btn" onclick="calcInput('.')">.</button>
                </div>

                <a href="https://www.taishinbank.com.tw/TSB/personal/deposit/lookup/history/JPY/" target="_blank" class="external-link">
                    æŸ¥è©¢å°æ–°åŒ¯ç‡
                </a>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨æ‡¸æµ®å°èˆª Dock -->
    <div class="dock-container">
        <div class="dock">
            <div class="dock-item active" onclick="switchTab('overview', this)">
                <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                <span>ç¸½è¦½</span>
            </div>
            <div class="dock-item" onclick="switchTab('daily', this)">
                <svg viewBox="0 0 24 24"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2zm-7 5h5v5h-5v-5z"/></svg>
                <span>è¡Œç¨‹</span>
            </div>
            <div class="dock-item" onclick="switchTab('shopping', this)">
                <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                <span>æ¸…å–®</span>
            </div>
            <!-- æ–°å¢åŒ¯ç‡æŒ‰éˆ• -->
            <div class="dock-item" onclick="switchTab('currency', this)">
                <svg viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
                <span>åŒ¯ç‡</span>
            </div>
        </div>
    </div>

    <!-- èˆªç­è©³ç´°è³‡è¨Š Modal -->
    <div id="flight-modal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h3>èˆªç­è³‡è¨Š</h3>
                <button class="close-modal-btn" onclick="closeModal(event)">âœ•</button>
            </div>
            <!-- èˆªç­å…§å®¹çœç•¥ (ä¿æŒä¸è®Š) -->
             <!-- å»ç¨‹ -->
             <div class="flight-leg outbound">
                <div class="leg-header">
                    <span class="tag outbound">å»ç¨‹</span>
                    <span class="date">2/21 (å…­)</span>
                </div>
                <div class="flight-route">
                    <div class="point">
                        <div class="time">07:30</div>
                        <div class="code">TPE T1</div>
                    </div>
                    <div class="arrow">âœˆ</div>
                    <div class="point">
                        <div class="time">10:35</div>
                        <div class="code">KMJ</div>
                    </div>
                </div>
                <div class="flight-detail">
                    <div style="font-weight:600; margin-bottom:4px;">æ˜Ÿå®‡èˆªç©º JX 846</div>
                    <span class="pnr">è¨‚ä½ä»£è™Ÿ: DI3FCZ</span>
                </div>
            </div>

            <!-- å›ç¨‹ -->
            <div class="flight-leg inbound">
                <div class="leg-header">
                    <span class="tag inbound">å›ç¨‹</span>
                    <span class="date">2/27 (äº”)</span>
                </div>
                <div class="flight-route">
                    <div class="point">
                        <div class="time">18:30</div>
                        <div class="code">FUK</div>
                    </div>
                    <div class="arrow">âœˆ</div>
                    <div class="point">
                        <div class="time">20:10</div>
                        <div class="code">TPE T2</div>
                    </div>
                </div>
                <div class="flight-detail">
                    <div style="font-weight:600; margin-bottom:4px;">ä¸­è¯èˆªç©º CI 129</div>
                    <span class="pnr">è¨‚ä½ä»£è™Ÿ: DI6FWQ</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¿®æ”¹åŒ¯ç‡ Modal -->
    <div id="rate-modal" class="modal-overlay" onclick="closeRateModal(event)">
        <div class="modal-content" style="max-width: 320px;">
            <div class="modal-header">
                <h3>è¨­å®šåŒ¯ç‡</h3>
                <button class="close-modal-btn" onclick="closeRateModal(event)">âœ•</button>
            </div>
            <div style="margin-bottom: 20px;">
                <p style="color:var(--text-secondary); font-size:14px; margin-top:0;">1 æ—¥åœ“ (JPY) ç­‰æ–¼å¤šå°‘ å°å¹£ (TWD)ï¼Ÿ</p>
                <div class="add-row" style="margin-bottom:0;">
                    <input type="number" id="new-rate-input" class="ios-input" placeholder="0.2" step="0.0001" style="text-align:center; font-size:24px; font-weight:700;">
                </div>
            </div>
            <button class="add-btn" style="width:100%; border-radius:12px; font-size:16px; font-weight:600;" onclick="saveRate()">å„²å­˜è¨­å®š</button>
        </div>
    </div>

    <script>
        // --- åŒ¯ç‡è¨ˆç®—æ©Ÿé‚è¼¯ ---
        let exchangeRate = parseFloat(localStorage.getItem('kyushu_rate')) || 0.2;
        let isJpyToTwd = true;
        let calcExpression = "";

        function initCurrency() {
            document.getElementById('current-rate-display').innerText = exchangeRate.toFixed(4);
            updateCalcDisplay();
        }

        function toggleCurrencyMode() {
            isJpyToTwd = !isJpyToTwd;
            const btnText = document.getElementById('currency-mode-text');
            const hintText = document.getElementById('calc-mode-hint');
            
            if(isJpyToTwd) {
                btnText.innerText = "æ—¥å¹£ JPY â†’ å°å¹£ TWD";
                hintText.innerText = "è¼¸å…¥ JPY";
            } else {
                btnText.innerText = "å°å¹£ TWD â†’ æ—¥å¹£ JPY";
                hintText.innerText = "è¼¸å…¥ TWD";
            }
            updateCalcDisplay();
        }

        function calcInput(val) {
            if (val === 'C') {
                calcExpression = "";
            } else if (val === 'DEL') {
                calcExpression = calcExpression.slice(0, -1);
            } else if (val === '=') {
                try {
                    // å®‰å…¨è¨ˆç®—
                    const result = eval(calcExpression); 
                    calcExpression = result.toString();
                } catch (e) {
                    calcExpression = "Error";
                }
            } else {
                // é˜²æ­¢é‡è¤‡é‹ç®—å­
                const lastChar = calcExpression.slice(-1);
                const ops = ['+', '-', '*', '/', '.'];
                if (ops.includes(val) && ops.includes(lastChar)) {
                    calcExpression = calcExpression.slice(0, -1) + val;
                } else {
                    calcExpression += val;
                }
            }
            updateCalcDisplay();
        }

        function updateCalcDisplay() {
            const inputEl = document.getElementById('calc-input');
            const resultEl = document.getElementById('calc-result');
            
            // é¡¯ç¤ºè¼¸å…¥é‹ç®—å¼
            inputEl.innerText = calcExpression || "0";
            
            // è¨ˆç®—ä¸¦æ›ç®—
            let currentVal = 0;
            try {
                if(calcExpression) {
                    currentVal = eval(calcExpression);
                }
            } catch(e) {} // å¿½ç•¥è¨ˆç®—éç¨‹ä¸­çš„éŒ¯èª¤

            if (isNaN(currentVal) || !isFinite(currentVal)) {
                resultEl.innerText = "---";
                return;
            }

            // æ›ç®—
            if (isJpyToTwd) {
                // JPY * Rate = TWD
                const converted = currentVal * exchangeRate;
                resultEl.innerText = `â‰ˆ NT$${Math.round(converted).toLocaleString()}`;
            } else {
                // TWD / Rate = JPY
                const converted = currentVal / exchangeRate;
                resultEl.innerText = `â‰ˆ Â¥${Math.round(converted).toLocaleString()}`;
            }
        }

        // åŒ¯ç‡ Modal æ§åˆ¶
        function openRateModal() {
            document.getElementById('new-rate-input').value = exchangeRate;
            document.getElementById('rate-modal').classList.add('show');
        }

        function closeRateModal(event) {
            if (event.target === event.currentTarget || event.target.closest('.close-modal-btn')) {
                document.getElementById('rate-modal').classList.remove('show');
            }
        }

        function saveRate() {
            const newRate = parseFloat(document.getElementById('new-rate-input').value);
            if(newRate > 0) {
                exchangeRate = newRate;
                localStorage.setItem('kyushu_rate', newRate);
                document.getElementById('current-rate-display').innerText = newRate.toFixed(4);
                updateCalcDisplay();
                document.getElementById('rate-modal').classList.remove('show');
            } else {
                alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„åŒ¯ç‡");
            }
        }

        // --- Modal æ§åˆ¶é‚è¼¯ ---
        function showFlightModal() {
            document.getElementById('flight-modal').classList.add('show');
        }

        function closeModal(event) {
            // å¦‚æœé»æ“Šçš„æ˜¯é®ç½©èƒŒæ™¯ æˆ– é—œé–‰æŒ‰éˆ•ï¼Œå‰‡é—œé–‰
            // event.target === event.currentTarget ç¢ºä¿åªåœ¨é»æ“Šé®ç½©å±¤æœ¬èº«æ™‚é—œé–‰ï¼Œè€Œä¸æ˜¯é»æ“Šå…§å®¹æ™‚
            if (event.target === event.currentTarget || event.target.closest('.close-modal-btn')) {
                document.getElementById('flight-modal').classList.remove('show');
            }
        }

        // --- 1. è¡Œç¨‹è³‡æ–™ (å·²è£œå®Œé‚è¼¯ä¸¦åŠ å…¥é«”åŠ›æ¶ˆè€—) ---
        const tripData = {
            "2026-02-21": {
                label: "2/21 (å…­)",
                title: "ç†Šæœ¬æŠµé”",
                stamina: 3, // é ä¼°é«”åŠ›æ¶ˆè€— (1-5)
                events: [
                    { time: "10:35", title: "æŠµé”ç†Šæœ¬", desc: "å‰å¾€é£¯åº—å¯„æ”¾è¡Œæï¼Œç¨å¾®ä¼‘æ¯", location: "ç†Šæœ¬ REF é£¯åº—" },
                    { time: "13:00", title: "ç†Šæœ¬åŸå·¡ç¦®", desc: "åŸå½©è‹‘ã€ç†Šæœ¬åŸç¨»è·ç¥ç¤¾ã€äºŒä¹‹ä¸¸å…¬åœ’", location: "ç†Šæœ¬åŸ" },
                    { time: "15:30", title: "æ°´å‰å¯ºæˆè¶£åœ’", desc: "è§€è³é­¯å¤«é›•åƒï¼Œæ—¥å¼åº­åœ’æ•£æ­¥", location: "æ°´å‰å¯ºæˆè¶£åœ’" },
                    { time: "18:00", title: "ä¸Šä¸‹é€šå•†åº—è¡—", desc: "æ™šé¤èˆ‡é€›è¡—æ¡è³¼", location: "ä¸‹é€šå•†åº—è¡—" }
                ]
            },
            "2026-02-22": {
                label: "2/22 (æ—¥)",
                title: "é˜¿è˜‡ä¸€æ—¥éŠ",
                stamina: 4,
                events: [
                    { time: "09:00", title: "å‰å¾€é˜¿è˜‡", desc: "åƒåŠ é å®šè¡Œç¨‹æˆ–ç§Ÿè»Š", location: "é˜¿è˜‡é§…" },
                    { time: "10:30", title: "è‰åƒé‡Œä¹‹æ¿±", desc: "è§€è³ç«å±±å£¯éº—æ™¯è‰²", location: "è‰åƒé‡Œ" },
                    { time: "12:30", title: "é˜¿è˜‡ç¥ç¤¾", desc: "åƒæ‹œèˆ‡å‘¨é‚Šåˆé¤", location: "é˜¿è˜‡ç¥ç¤¾" },
                    { time: "16:00", title: "è¿”å›ç†Šæœ¬", desc: "å¸‚å€æ™šé¤", location: "ç†Šæœ¬é§…" }
                ]
            },
            "2026-02-23": {
                label: "2/23 (ä¸€)",
                title: "ç§»å‹•æ—¥ï¼šæ©«æ–·åˆ—è»Š",
                stamina: 2,
                events: [
                    { time: "11:49", title: "æ­ä¹˜ä¹å·æ©«æ–·ç‰¹æ€¥ 3", desc: "ç†Šæœ¬ç™¼è»Šï¼Œè¨˜å¾—å…ˆç”¨ JR Pass é ç´„æœ€å¾Œä¸€æ’åº§ä½æ”¾è¡Œæ", location: "ç†Šæœ¬é§…" },
                    { time: "15:08", title: "æŠµé”å¤§åˆ†", desc: "å‰å¾€é£¯åº— Check-in", location: "å¤§åˆ†é§…" },
                    { time: "16:30", title: "å¤§åˆ†è»Šç«™å‘¨é‚Š", desc: "AMU PLAZA é€›è¡—ã€æ™šé¤", location: "JRå¤§åˆ†åŸ" }
                ]
            },
            "2026-02-24": {
                label: "2/24 (äºŒ)",
                title: "ç”±å¸ƒé™¢æ•£ç­–",
                stamina: 3,
                events: [
                    { time: "13:25", title: "å‰å¾€ç”±å¸ƒé™¢", desc: "JR ç§»å‹•ï¼Œç´„ 1 å°æ™‚è»Šç¨‹", location: "ç”±å¸ƒé™¢é§…" },
                    { time: "14:15", title: "æ¹¯ä¹‹åªè¡—é“", desc: "é€›è¡—ã€é‡‘é±—æ¹–æ‹ç…§", location: "é‡‘é±—æ¹–" },
                    { time: "15:56", title: "ç”±å¸ƒé™¢ä¹‹æ£® (å‚™æ¡ˆ17:17)", desc: "å‰å¾€åšå¤šã€‚è¡Œæå¯å…ˆé‹é€è‡³ç¦å²¡ï¼Œæˆ–é ç´„ç«è»Šè¡Œæä½", location: "ç”±å¸ƒé™¢é§…" },
                    { time: "18:10", title: "æŠµé”åšå¤š", desc: "å…¥ä½ä¸­æ´²é£¯åº—", location: "åšå¤šé§…" }
                ]
            },
            "2026-02-25": {
                label: "2/25 (ä¸‰)",
                title: "å¤ªå®°åºœèˆ‡å¤©ç¥",
                stamina: 4,
                events: [
                    { time: "09:30", title: "å¤ªå®°åºœå¤©æ»¿å®®", desc: "åƒæ‹œã€è¡¨åƒé“åƒæ¢…æé¤…", location: "å¤ªå®°åºœå¤©æ»¿å®®" },
                    { time: "11:30", title: "å¯¶æ»¿å®®ç«ˆé–€ç¥ç¤¾", desc: "çµç·£ç¥ç¤¾ (é¬¼æ»…ä¹‹åˆƒè–åœ°)", location: "å®æº€å®®ç«ˆé–€ç¥ç¤¾" },
                    { time: "14:30", title: "å¤©ç¥åœ°ä¸‹è¡—", desc: "è³¼ç‰©èˆ‡ä¸‹åˆèŒ¶", location: "å¤©ç¥åœ°ä¸‹è¡—" },
                    { time: "18:00", title: "ä¸­æ´²å±‹å°", desc: "é«”é©—åšå¤šå¤œç”Ÿæ´»", location: "ä¸­æ´²å±‹å°" }
                ]
            },
            "2026-02-26": {
                label: "2/26 (å››)",
                title: "é–€å¸æ¸¯æ‡·èˆŠ",
                stamina: 3,
                events: [
                    { time: "10:00", title: "å‰å¾€é–€å¸æ¸¯", desc: "åšå¤š -> é–€å¸æ¸¯", location: "é–€å¸æ¸¯é§…" },
                    { time: "11:00", title: "é–€å¸æ¸¯æ‡·èˆŠå€", desc: "åƒç‡’å’–å“©ã€çœ‹è—ç¿¼æ©‹é–‹æ©‹", location: "é–€å¸æ¸¯æ‡·èˆŠå±•æœ›å®¤" },
                    { time: "14:00", title: "å°å€‰åŸ", desc: "é †éŠæ—¦éå¸‚å ´", location: "å°å€‰åŸ" },
                    { time: "17:30", title: "çš¿å€‰å±±å¤œæ™¯", desc: "æ–°æ—¥æœ¬ä¸‰å¤§å¤œæ™¯ (è¦–å¤©æ°£æ±ºå®š)", location: "çš¿å€‰å±±" }
                ]
            },
            "2026-02-27": {
                label: "2/27 (äº”)",
                title: "ç¦å²¡å¸‚å€ & è¿”å°",
                stamina: 2,
                events: [
                    { time: "09:30", title: "æ«›ç”°ç¥ç¤¾", desc: "åšå¤šç¸½é®å®ˆ", location: "æ«›ç”°ç¥ç¤¾" },
                    { time: "11:00", title: "åšå¤šé‹æ²³åŸ", desc: "æœ€å¾Œè³¼ç‰©èˆ‡æ°´èˆç§€", location: "åšå¤šé‹æ²³åŸ" },
                    { time: "14:00", title: "ä½å‰ç¥ç¤¾/ç¦å²¡åŸè·¡", desc: "å¸‚å€æ‚ é–’æ•£æ­¥", location: "ä½å‰ç¥ç¤¾" },
                    { time: "16:00", title: "å‰å¾€ç¦å²¡æ©Ÿå ´", desc: "æ­ä¹˜åœ°éµæˆ–å·´å£«", location: "ç¦å²¡ç©ºæ¸¯" },
                    { time: "18:30", title: "èµ·é£›è¿”å°", desc: "Goodbye Kyushu!", location: "" }
                ]
            }
        };

        // --- 2. åˆå§‹åŒ– ---
        window.onload = function() {
            initDayNav();
            renderTimeline("2026-02-21"); // é è¨­é¡¯ç¤ºç¬¬ä¸€å¤©
            loadShopping();
            initCurrency(); // åˆå§‹åŒ–åŒ¯ç‡
        };

        // --- 3. é é¢åˆ‡æ›é‚è¼¯ ---
        function switchTab(tabId, el) {
            // åˆ‡æ› View
            document.querySelectorAll('.section-view').forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById('view-' + tabId).classList.add('active');

            // åˆ‡æ› Dock ç‹€æ…‹
            document.querySelectorAll('.dock-item').forEach(item => {
                item.classList.remove('active');
            });
            el.classList.add('active');

            // æ»¾å‹•å›é ‚éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- 4. è¡Œç¨‹æ¸²æŸ“é‚è¼¯ ---
        function initDayNav() {
            const nav = document.getElementById('day-nav');
            let html = '';
            Object.keys(tripData).forEach((date, index) => {
                const day = tripData[date];
                const activeClass = index === 0 ? 'active' : '';
                html += `<div class="date-chip ${activeClass}" onclick="changeDate('${date}', this)">${day.label}</div>`;
            });
            nav.innerHTML = html;
        }

        function changeDate(date, el) {
            // æ›´æ–° Chip æ¨£å¼
            document.querySelectorAll('.date-chip').forEach(chip => chip.classList.remove('active'));
            el.classList.add('active');
            
            // æ¸²æŸ“æ™‚é–“è»¸
            renderTimeline(date);
        }

        function renderTimeline(date) {
            const container = document.getElementById('daily-timeline');
            const dayData = tripData[date];
            
            // æ¼¸è®Šå‹•ç•«
            container.style.opacity = 0;
            
            setTimeout(() => {
                let html = '';
                
                // åŠ å…¥ä»Šæ—¥æ¨™é¡Œèˆ‡é«”åŠ›æ¶ˆè€—
                const staminaStars = 'ğŸˆ'.repeat(dayData.stamina);
                html += `
                <div style="margin-bottom: 25px; padding-left: 10px;">
                    <h2 style="margin: 0; font-size: 22px; color: var(--text-primary);">${dayData.title}</h2>
                    <div class="stamina-level">é ä¼°é«”åŠ›æ¶ˆè€—: ${staminaStars}</div>
                </div>`;

                // åŠ å…¥é‡é»æç¤º (JR Pass)
                if(date === '2026-02-23' || date === '2026-02-24') {
                   html += `
                   <div style="margin-bottom:20px;">
                        <div class="note-alert">
                            <span>âš ï¸</span> 
                            <span>JR ç‰¹æ€¥åˆ—è»Šè¨˜å¾—å…ˆé ç´„æœ€å¾Œä¸€æ’åº§ä½æ”¾ç½®è¡Œæ</span>
                        </div>
                   </div>`;
                }

                dayData.events.forEach(ev => {
                    // Google Maps Link
                    const mapUrl = ev.location ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.location)}` : '';
                    const mapBtn = mapUrl ? `
                        <button class="map-btn" onclick="window.open('${mapUrl}', '_blank')">
                            <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5-2.5 2.5z"/></svg>
                        </button>` : '';

                    html += `
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="event-card">
                            <div class="event-header">
                                <div>
                                    <span class="time-badge">${ev.time}</span>
                                    <h3 class="event-title">${ev.title}</h3>
                                    <p class="event-desc">${ev.desc}</p>
                                </div>
                                ${mapBtn}
                            </div>
                        </div>
                    </div>`;
                });
                
                container.innerHTML = html;
                container.style.opacity = 1;
            }, 200);
        }

        // --- 5. è³¼ç‰©æ¸…å–®é‚è¼¯ (LocalStorage) ---
        function loadShopping() {
            const list = JSON.parse(localStorage.getItem('kyushu_shopping')) || [];
            renderShopList(list);
        }

        function addItem() {
            const input = document.getElementById('shop-name');
            const name = input.value.trim();
            if (!name) return;

            const list = JSON.parse(localStorage.getItem('kyushu_shopping')) || [];
            list.push({ id: Date.now(), name: name, done: false });
            
            localStorage.setItem('kyushu_shopping', JSON.stringify(list));
            input.value = '';
            renderShopList(list);
        }

        function toggleItem(id) {
            const list = JSON.parse(localStorage.getItem('kyushu_shopping')) || [];
            const idx = list.findIndex(i => i.id === id);
            if (idx > -1) {
                list[idx].done = !list[idx].done;
                localStorage.setItem('kyushu_shopping', JSON.stringify(list));
                renderShopList(list);
            }
        }

        function deleteItem(id) {
            // ç§»é™¤ confirm è¦–çª—ï¼Œç›´æ¥åˆªé™¤ï¼Œé¿å…åµŒå…¥ç’°å¢ƒç„¡æ³•å½ˆå‡ºè¦–çª—å°è‡´å¡ä½
            let list = JSON.parse(localStorage.getItem('kyushu_shopping')) || [];
            list = list.filter(i => i.id !== id);
            localStorage.setItem('kyushu_shopping', JSON.stringify(list));
            renderShopList(list);
        }

        function renderShopList(list) {
            const container = document.getElementById('shopping-list');
            if (list.length === 0) {
                container.innerHTML = '<div class="empty-state">å°šç„¡è³¼ç‰©é …ç›®</div>';
                return;
            }

            let html = '';
            list.forEach(item => {
                html += `
                <div class="shop-item ${item.done ? 'done' : ''}">
                    <div class="shop-content" onclick="toggleItem(${item.id})">
                        <div class="checkbox">
                            ${item.done ? '<span style="color:white; font-size:16px;">âœ“</span>' : ''}
                        </div>
                        <div class="item-info">
                            <h4>${item.name}</h4>
                        </div>
                    </div>
                    <button class="delete-btn" onclick="deleteItem(${item.id})">âœ•</button>
                </div>`;
            });
            container.innerHTML = html;
        }
    </script>
</body>
</html>
